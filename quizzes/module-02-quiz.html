<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module Quiz | DeFi University</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        const firebaseConfig = { apiKey: "AIzaSyDuGdDF6jYPcZbQTpbGZPwnl3Qynr-LMWc", authDomain: "defi-university-prod.firebaseapp.com", projectId: "defi-university-prod", storageBucket: "defi-university-prod.firebasestorage.app", messagingSenderId: "309871336262", appId: "1:309871336262:web:d2dc4be5729ac1d5a6a347" };
        const app = initializeApp(firebaseConfig); const auth = getAuth(app); const API_BASE_URL = 'https://api.defiuniversity.xyz/api';
        const pathParts = window.location.pathname.split('/'); const courseName = pathParts[pathParts.length - 2]; const quizFile = pathParts[pathParts.length - 1]; const modMatch = quizFile.match(/module-(\d+)/);
        window.courseId = courseName; window.moduleId = modMatch ? `module-${modMatch[1].padStart(2, '0')}` : 'module-01';
        onAuthStateChanged(auth, async (user) => { const loginPrompt = document.getElementById('login-prompt'); const quizContainer = document.getElementById('quiz-container'); const loadingState = document.getElementById('loading-state'); if (user) { window.userToken = await user.getIdToken(); if (loginPrompt) loginPrompt.classList.add('hidden'); await loadQuizData(); if (loadingState) loadingState.classList.add('hidden'); if (quizContainer) quizContainer.classList.remove('hidden'); } else { if (loadingState) loadingState.classList.add('hidden'); if (loginPrompt) loginPrompt.classList.remove('hidden'); if (quizContainer) quizContainer.classList.add('hidden'); const currentUrl = encodeURIComponent(window.location.href); const loginLink = document.querySelector('#login-prompt a'); if (loginLink) loginLink.href = `/login.html?redirect=${currentUrl}`; } });
        window.loadQuizData = async function() { try { const response = await fetch(`/defi-high-school/quizzes/questions/${window.courseId}.json`); const data = await response.json(); const module = data.modules.find(m => m.moduleId === window.moduleId); if (!module) return; window.quizData = module; window.questions = module.questions; window.passingScore = module.passingScore || 70; document.getElementById('quiz-title').textContent = module.title; document.getElementById('quiz-description').textContent = module.description; document.getElementById('total-questions').textContent = module.questions.length; document.getElementById('passing-score').textContent = module.passingScore + '%'; window.currentQuestionIndex = 0; window.userAnswers = {}; window.showingResults = false; renderQuestion(); } catch (error) { document.getElementById('quiz-container').innerHTML = '<div class="text-center py-12"><p class="text-red-600">Error loading quiz.</p></div>'; } };
        window.submitQuizToAPI = async function(score) { const controller = new AbortController(); const timeoutId = setTimeout(() => controller.abort(), 10000); try { const moduleNum = window.moduleId.replace('module-', '').replace(/^0+/, ''); const response = await fetch(`${API_BASE_URL}/progress/quiz`, { method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${window.userToken}` }, body: JSON.stringify({ courseId: window.courseId, quizId: `module-${moduleNum}-quiz`, score }), signal: controller.signal }); clearTimeout(timeoutId); if (response.ok) return await response.json(); return null; } catch (error) { clearTimeout(timeoutId); return null; } };
    </script>
    <style>body { font-family: 'Inter', sans-serif; } h1, h2, h3, h4, .brand-font { font-family: 'Space Grotesk', sans-serif; } .quiz-option { transition: all 0.2s ease; } .quiz-option:hover:not(.disabled) { border-color: rgba(37, 99, 235, 0.5); background-color: rgba(37, 99, 235, 0.05); } .quiz-option.selected { border-color: rgba(37, 99, 235, 0.8); background-color: rgba(37, 99, 235, 0.1); } .quiz-option.correct { border-color: rgba(34, 197, 94, 0.8) !important; background-color: rgba(34, 197, 94, 0.15) !important; } .quiz-option.incorrect { border-color: rgba(239, 68, 68, 0.8) !important; background-color: rgba(239, 68, 68, 0.1) !important; } .quiz-option.disabled { cursor: not-allowed; opacity: 0.7; }</style>
</head>
<body class="bg-white text-neutral-900 min-h-screen p-4 md:p-8">
    <div id="loading-state" class="flex items-center justify-center min-h-[400px]"><div class="text-center"><div class="w-8 h-8 border-2 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div><p class="text-neutral-500">Loading quiz...</p></div></div>
    <div id="login-prompt" class="hidden"><div class="max-w-md mx-auto text-center py-12"><div class="w-16 h-16 bg-neutral-100 rounded-full flex items-center justify-center mx-auto mb-4"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="text-neutral-400"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg></div><h2 class="text-xl font-semibold text-neutral-900 mb-2 brand-font">Sign in Required</h2><p class="text-neutral-500 mb-6">Please sign in to take this quiz.</p><a href="/login.html" class="inline-flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700">Sign In</a></div></div>
    <div id="quiz-container" class="hidden max-w-3xl mx-auto">
        <div class="mb-8 text-center"><p class="text-xs text-blue-600 mb-2 uppercase tracking-wider font-medium">Module Quiz</p><h1 id="quiz-title" class="text-2xl md:text-3xl font-semibold text-neutral-900 brand-font mb-2">Loading...</h1><p id="quiz-description" class="text-neutral-500 text-sm mb-4">Test your knowledge</p><div class="flex items-center justify-center gap-6 text-sm"><span class="text-neutral-500"><span id="total-questions">0</span> Questions</span><span class="text-neutral-500">Passing: <span id="passing-score">70%</span></span></div></div>
        <div class="mb-8"><div class="flex items-center justify-between text-xs text-neutral-500 mb-2"><span>Question <span id="current-question">1</span> of <span id="question-count">0</span></span><span id="progress-percent">0%</span></div><div class="h-2 bg-neutral-200 rounded-full overflow-hidden"><div id="progress-bar" class="h-full bg-gradient-to-r from-blue-600 to-blue-500 rounded-full transition-all duration-300" style="width: 0%"></div></div></div>
        <div id="question-card" class="bg-white border border-neutral-200 rounded-xl p-6 md:p-8 mb-6 shadow-sm"><p id="question-text" class="text-lg md:text-xl text-neutral-900 mb-6">Loading...</p><div id="options-container" class="space-y-3"></div><div id="feedback-container" class="hidden mt-6 p-4 rounded-lg border"><div class="flex items-start gap-3"><div id="feedback-icon" class="flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center"></div><div><p id="feedback-title" class="font-medium mb-1"></p><p id="feedback-explanation" class="text-sm text-neutral-500"></p></div></div></div></div>
        <div class="flex items-center justify-between"><button id="prev-btn" onclick="prevQuestion()" class="px-4 py-2 text-sm text-neutral-500 hover:text-neutral-900 border border-neutral-200 rounded-lg hover:border-neutral-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed bg-white" disabled>← Previous</button><div class="flex gap-2"><button id="next-btn" onclick="nextQuestion()" class="px-6 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors shadow-md shadow-blue-600/20">Next →</button><button id="submit-btn" onclick="submitQuiz()" class="hidden px-6 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors shadow-md shadow-blue-600/20">Submit Quiz</button><button id="retake-btn" onclick="retakeQuiz()" class="hidden px-6 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors shadow-md shadow-blue-600/20">Re-take Quiz</button></div></div>
        <div id="results-container" class="hidden mt-8"><div class="bg-white border border-neutral-200 rounded-xl p-8 text-center shadow-sm"><div id="results-icon" class="w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6"></div><h2 id="results-title" class="text-2xl font-semibold text-neutral-900 mb-2 brand-font">Quiz Complete!</h2><p id="results-score" class="text-5xl font-bold text-blue-600 mb-2">0%</p><p id="results-message" class="text-neutral-500 mb-6"></p><div id="points-awarded" class="inline-flex items-center gap-2 px-5 py-3 bg-blue-50 border border-blue-200 rounded-xl text-blue-600 mb-6"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path></svg><span class="text-lg font-semibold">+<span id="points-value">0</span> points</span></div><div class="flex flex-col sm:flex-row gap-3 justify-center"><button onclick="reviewAnswers()" class="px-6 py-3 text-sm font-medium text-neutral-700 bg-white border border-neutral-200 rounded-lg hover:bg-neutral-50">Review Answers</button><a href="/courses.html" class="px-6 py-3 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700">Back to Account Hub</a></div></div><div id="review-section" class="hidden mt-8 space-y-4"><h3 class="text-lg font-semibold text-neutral-900 brand-font mb-4">Answer Review</h3><div id="review-container"></div></div></div>
    </div>
    <script>
        function renderQuestion() { if (!window.questions || window.questions.length === 0) return; const question = window.questions[window.currentQuestionIndex]; answered = window.userAnswers[question.id] !== undefined; document.getElementById('question-text').textContent = question.question; document.getElementById('current-question').textContent = window.currentQuestionIndex + 1; document.getElementById('question-count').textContent = window.questions.length; document.getElementById('options-container').innerHTML = question.options.map(opt => `<button onclick="selectAnswer('${question.id}', '${opt.id}')" class="quiz-option w-full text-left px-4 py-4 border border-neutral-200 rounded-xl text-neutral-700 hover:text-neutral-900 ${window.userAnswers[question.id] === opt.id ? 'selected' : ''} ${answered ? 'disabled' : ''}" data-option="${opt.id}" ${answered ? 'disabled' : ''}><span class="inline-flex items-center justify-center w-7 h-7 rounded-lg border border-current text-sm mr-3 font-medium">${opt.id.toUpperCase()}</span>${opt.text}</button>`).join(''); if (answered) showFeedback(question, window.userAnswers[question.id]); else document.getElementById('feedback-container').classList.add('hidden'); updateProgress(); updateNavigation(); }
        function selectAnswer(questionId, optionId) { if (answered) return; window.userAnswers[questionId] = optionId; answered = true; document.querySelectorAll('.quiz-option').forEach(btn => { btn.classList.remove('selected'); btn.classList.add('disabled'); btn.disabled = true; if (btn.dataset.option === optionId) btn.classList.add('selected'); }); showFeedback(window.questions[window.currentQuestionIndex], optionId); updateNavigation(); }
        function showFeedback(question, selectedAnswer) { const isCorrect = selectedAnswer === question.correctAnswer; const feedbackContainer = document.getElementById('feedback-container'); const feedbackIcon = document.getElementById('feedback-icon'); const feedbackTitle = document.getElementById('feedback-title'); document.querySelectorAll('.quiz-option').forEach(btn => { if (btn.dataset.option === question.correctAnswer) btn.classList.add('correct'); else if (btn.dataset.option === selectedAnswer && !isCorrect) btn.classList.add('incorrect'); }); feedbackContainer.classList.remove('hidden'); if (isCorrect) { feedbackContainer.className = 'mt-6 p-4 rounded-lg border border-green-500/30 bg-green-50'; feedbackIcon.className = 'flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center bg-green-500'; feedbackIcon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3"><path d="M20 6 9 17l-5-5"></path></svg>'; feedbackTitle.textContent = 'Correct!'; feedbackTitle.className = 'font-medium mb-1 text-green-600'; } else { feedbackContainer.className = 'mt-6 p-4 rounded-lg border border-red-500/30 bg-red-50'; feedbackIcon.className = 'flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center bg-red-500'; feedbackIcon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>'; feedbackTitle.textContent = 'Incorrect'; feedbackTitle.className = 'font-medium mb-1 text-red-600'; } document.getElementById('feedback-explanation').textContent = question.explanation; }
        function updateProgress() { const total = window.questions.length; const answeredCount = Object.keys(window.userAnswers).length; const percent = Math.round((answeredCount / total) * 100); document.getElementById('progress-percent').textContent = `${percent}%`; document.getElementById('progress-bar').style.width = `${percent}%`; }
        function updateNavigation() { document.getElementById('prev-btn').disabled = window.currentQuestionIndex === 0; const allAnswered = Object.keys(window.userAnswers).length === window.questions.length; const isLastQuestion = window.currentQuestionIndex === window.questions.length - 1; if (isLastQuestion && allAnswered) { document.getElementById('next-btn').classList.add('hidden'); document.getElementById('submit-btn').classList.remove('hidden'); } else { document.getElementById('next-btn').classList.remove('hidden'); document.getElementById('submit-btn').classList.add('hidden'); } }
        function prevQuestion() { if (window.currentQuestionIndex > 0) { window.currentQuestionIndex--; renderQuestion(); } }
        function nextQuestion() { if (window.currentQuestionIndex < window.questions.length - 1) { window.currentQuestionIndex++; renderQuestion(); } }
        async function submitQuiz() { let correctCount = 0; window.questions.forEach(q => { if (window.userAnswers[q.id] === q.correctAnswer) correctCount++; }); const score = Math.round((correctCount / window.questions.length) * 100); const passed = score >= window.passingScore; const result = await window.submitQuizToAPI(score); document.getElementById('question-card').classList.add('hidden'); document.querySelector('.flex.items-center.justify-between').classList.add('hidden'); document.getElementById('results-container').classList.remove('hidden'); document.getElementById('results-score').textContent = `${score}%`; document.getElementById('results-message').textContent = `You answered ${correctCount} out of ${window.questions.length} questions correctly.`; document.getElementById('points-value').textContent = result?.pointsAwarded || 0; const iconContainer = document.getElementById('results-icon'); const resultsTitle = document.getElementById('results-title'); if (passed) { if (score === 100) { iconContainer.className = 'w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 bg-blue-50'; iconContainer.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-blue-600"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path></svg>'; resultsTitle.textContent = 'Perfect Score!'; } else { iconContainer.className = 'w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 bg-green-50'; iconContainer.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-green-600"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path><path d="m9 12 2 2 4-4"></path></svg>'; resultsTitle.textContent = 'Quiz Passed!'; } document.getElementById('results-score').className = 'text-5xl font-bold text-blue-600 mb-2'; } else { iconContainer.className = 'w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 bg-orange-50'; iconContainer.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-orange-600"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>'; resultsTitle.textContent = 'Keep Learning!'; document.getElementById('results-score').className = 'text-5xl font-bold text-orange-600 mb-2'; } if (result?.message === 'Quiz already completed') { document.getElementById('points-awarded').innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-neutral-400"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path><path d="m9 12 2 2 4-4"></path></svg><span class="text-neutral-500">Previously completed (best: ${result.previousBest}%)</span>`; } document.getElementById('retake-btn').classList.remove('hidden'); }
        function reviewAnswers() { const reviewSection = document.getElementById('review-section'); const reviewContainer = document.getElementById('review-container'); reviewSection.classList.toggle('hidden'); if (!reviewSection.classList.contains('hidden')) { reviewContainer.innerHTML = window.questions.map((q, i) => { const userAnswer = window.userAnswers[q.id]; const isCorrect = userAnswer === q.correctAnswer; const userOption = q.options.find(o => o.id === userAnswer); const correctOption = q.options.find(o => o.id === q.correctAnswer); return `<div class="bg-white border ${isCorrect ? 'border-green-500/30' : 'border-red-500/30'} rounded-xl p-5"><div class="flex items-start gap-3 mb-3"><span class="flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center text-xs font-medium ${isCorrect ? 'bg-green-500 text-white' : 'bg-red-500 text-white'}">${i + 1}</span><p class="text-neutral-900">${q.question}</p></div><div class="ml-9 space-y-2 text-sm"><p class="${isCorrect ? 'text-green-600' : 'text-red-600'}">Your answer: ${userOption?.text || 'Not answered'}</p>${!isCorrect ? `<p class="text-green-600">Correct answer: ${correctOption?.text}</p>` : ''}<p class="text-neutral-500 mt-2">${q.explanation}</p></div></div>`; }).join(''); } }
        function retakeQuiz() { window.currentQuestionIndex = 0; window.userAnswers = {}; document.getElementById('results-container').classList.add('hidden'); document.getElementById('review-section').classList.add('hidden'); document.getElementById('question-card').classList.remove('hidden'); document.querySelector('.flex.items-center.justify-between').classList.remove('hidden'); document.getElementById('retake-btn').classList.add('hidden'); renderQuestion(); }
    </script>
</body>
</html>
